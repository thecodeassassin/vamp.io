<!DOCTYPE html>




 <html class="no-js"> 
<head>

<script type="text/javascript">
theBaseUrl = "http://vamp.io/";
</script>
<base href="http://vamp.io/" />

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
  <title>Environment variables - Vamp</title>
  <meta name="generator" content="Hugo 0.18-DEV" />

  
  <meta name="description" content="Vamp - Deploy and manage microservices with power and ease.">
  
  <link rel="canonical" href="./documentation/using-vamp/environment-variables/">
  
  <meta name="author" content="magnetic.io">
  

  <meta property="og:url" content="/documentation/using-vamp/environment-variables/">
  <meta property="og:title" content="Vamp">
  <meta property="og:image" content="/images/logo.svg">
  <meta name="apple-mobile-web-app-title" content="Vamp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="shortcut icon" type="image/x-icon" href="./images/logo.svg">
  <link rel="icon" type="image/x-icon" href="./images/logo.svg">


  <style>
    @font-face {
      font-family: 'Icon';
      src: url('fonts/icon.eot?52m981');
      src: url('fonts/icon.eot?#iefix52m981')
      format('embedded-opentype'),
      url('fonts/icon.woff?52m981')
      format('woff'),
      url('fonts/icon.ttf?52m981')
      format('truetype'),
      url('fonts/icon.svg?52m981#icon')
      format('svg');
      font-weight: normal;
      font-style: normal;
    }
  </style>

  <link rel="stylesheet" href="css/style.css">

  <script src="js/vendor.js"></script>

  <script src="js/app.js"></script>

  
</head>
<body class="palette-primary-pink palette-accent-pink">


<div class="single-page">
  <nav aria-label="Header" id="header" class="top-menu">
  <div class="left">
    <a href="./">
      <div id="logo" class="logo"></div>
    </a>
  </div>

  <div class="right">
    <div class="top-menu-items" id="top-menu-items">

    </div>

    <div class="download">
      <a href="./documentation/installation/hello-world/" class="button button--red">
        Try Vamp
      </a>
    </div>

    <a href="https://github.com/magneticio/vamp" target="_blank" class="github-logo">
      <i class="fa fa-2x fa-github" aria-hidden="true"></i>
    </a>

    <div class="search-button">
      <i class="fa fa-lg fa-search"></i>
    </div>

  </div>
</nav>

<ul id="mobile-menu" style="display: none">
</ul>

<div id="search">
  <div class="search-bar">
    <div class="search-bar__back">
      <i class="fa fa-lg fa-times"></i>
    </div>
    <input class="search-bar__input" placeholder="Type your search here...">
  </div>
  <div class="search-results">
    <ul></ul>
  </div>
</div>


</div>

<div class="page documentation">
    <div class="menu" id="side-menu">
    </div>
    <div class="content">
      <h1 class="content-header">Environment variables </h1>
      <div class="markdowned">
        

<p>Breeds and blueprints can include lists of environment variables that will be injected into the container at runtime. You set environment variables with the <code>environment_variables</code> keyword or its shorter version <code>env</code>, e.g. both examples below are equivalent.</p>

<pre><code class="language-yaml">---
environment_variables:
  PORT: 8080
</code></pre>

<pre><code class="language-yaml">---
env:
  PORT: 8080
</code></pre>

<h2 id="dependencies">Dependencies</h2>

<p>Breeds can also have dependencies on other breeds. These dependencies should be stated explicitly, similar to how you would do in a Maven pom.xml, a Ruby Gemfile or similar package dependency systems, i.e:</p>

<pre><code class="language-yaml">---
dependencies:
  cache: redis:1.1
</code></pre>

<p>In a lot of cases, dependencies coexist with interpolated environment variables or constants because exact values are not known untill deploy time.</p>

<h2 id="hard-setting-a-variable">&lsquo;Hard&rsquo; setting a variable</h2>

<p>You want to &ldquo;hard set&rdquo; an environment variable, just like doing an <code>export MY_VAR=some_value</code> in a shell. This  variable could be some external dependency you have no direct control over: the endpoint of some service you use that is out of your control. It can also be some setting you want to tweak, like <code>JVM_HEAP_SIZE</code> or <code>AWS_REGION</code>.</p>

<pre><code class="language-yaml">---
name: java_aws_app:1.2.1
deployable: acmecorp/tomcat:1.2.1

environment_variables:
  JVM_HEAP_SIZE: 1200
  AWS_REGION: 'eu-west-1'     
</code></pre>

<p>It is also possible to use wildcard <code>*</code> at the end of the name:</p>

<pre><code class="language-yaml">---
dependencies:
  cache: redis:1.*
</code></pre>

<p>This will match any breed name that starts with <code>redis:1.</code></p>

<h2 id="using-place-holders">Using place holders</h2>

<p>Use the <code>~</code> character to define a place holder for a variable that should be filled in at runtime (i.e. when this breed actually gets deployed), but for which you do not yet know the actual value.</p>

<div class="admonition tip">
  <p class="admonition-title">Typical use case</p>
  <p><ul>
<li>When different roles in a company work on the same project. Developers can create place holders for variables that operations should fill in: it helps with separating responsibilities.</li>
</ul>
</p>
</div>

<h4 id="example-oracle-password-designated-as-a-place-holder">Example - <code>ORACLE_PASSWORD</code> designated as a place holder</h4>

<pre><code class="language-yaml">---
name: java_aws_app:1.2.1
deployable: acmecorp/tomcat:1.2.1
environment_variables:
  JVM_HEAP_SIZE: 1200
  AWS_REGION: 'eu-west-1' 
  ORACLE_PASSWORD: ~    
</code></pre>

<h2 id="resolving-variables">Resolving variables</h2>

<p>Use the <code>$</code> character to reference other statements in a breed/blueprint. This allows you to dynamically resolve ports and hosts names that we don&rsquo;t know until a deployment is done. You can also resolve to hard coded and published constants from some other part of the blueprint or breed, typically a dependency.</p>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>The <code>$</code> value is escaped by <code>$$</code>. A more strict notation is <code>${some_reference}</code></p>
</div>

<h3 id="vamp-host-variable">Vamp host variable</h3>

<p>Vamp provides just one *magic** variable: the <code>host</code>. This resolves to the host or ip address of the referenced service. Strictly speaking, the <code>host</code> reference resolves to the gateway agent endpoint, but users do not need to concern themselves with this. Users can think of one-on-one connections where Vamp actually does server-side service discovery to decouple services.</p>

<h4 id="example-resolving-variables-from-a-dependency">Example - resolving variables from a dependency</h4>

<pre><code class="language-yaml">---
name: blueprint1
clusters:
  frontend:
    breed:
      name: frontend_app:1.0
      deployable: acmecorp/tomcat:1.2.1      
    environment_variables:
      MYSQL_HOST: $backend.host        # resolves to a host at runtime
      MYSQL_PORT: $backend.ports.port  # resolves to a port at runtime
    dependencies:
      backend: mysql:1.0
  backend:
    breed: mysql:1.0
</code></pre>

<h4 id="example-resolving-variables-from-a-dependency-s-environment-variables">Example - resolving variables from a dependency&rsquo;s environment variables</h4>

<p>What if the backend is configured through some environment variable, but the frontend also needs that information? For example, the encoding type for our database. We can just reference that environment variable using the exact same syntax.</p>

<pre><code class="language-yaml">---
name: blueprint1
clusters:
  frontend:
    breed:
      name: frontend_app:1.0
      deployable: acmecorp/tomcat:1.2.1      
    environment_variables:
      MYSQL_HOST: $backend.host       
      MYSQL_PORT: $backend.ports.port 
      BACKEND_ENCODING: $backend.environment_variables.ENCODING_TYPE
    dependencies:
      backend: mysql:1.0
  backend:
    breed: mysql:1.0
    environment_variables:
      ENCODING_TYPE: 'UTF8'   # injected into the backend MySQL container
</code></pre>

<p>You can do everything with <code>environment_variables</code> but <code>constants</code> (see below) allow you to just be a little bit cleaner with regard to what you want to expose and what not.</p>

<h2 id="environment-variable-scope">Environment variable scope</h2>

<p>Environment variables can live on different scopes and can be overridden by scopes higher in the scope hierarchy.
A scope is an area of your breed or blueprint definition that limits the visibility of variables and references inside that scope.</p>

<ol>
<li><p><strong>Breed scope</strong>: The scope used in all the above examples is the default scope. If you never define any <code>environment_variables</code> in any other place, this will be used.</p></li>

<li><p><strong>Cluster scope</strong>: Will override the breed scope and is part of the blueprint artifact. Use this to override environment variables for all services that belong to a cluster.</p></li>

<li><p><strong>Service scope</strong>: Will override breed scope and cluster scope, and is part of the blueprint artifact. Use this to override all environment variables for a specific service within a cluster.</p></li>
</ol>

<div class="admonition note">
  <p class="admonition-title">Note!</p>
  <p>Effective use of scope is completely dependent on your use case. The various scopes help to separate concerns when multiple people and/or teams work on Vamp artifacts and deployments and need to decouple their effort.</p>
</div>

<h3 id="examples-of-scope-use">Examples of scope use</h3>

<ul>
<li><a href="./documentation/using-vamp/environment-variables/#example-1">Run two of the same services with different configurations</a></li>
<li><a href="./documentation/using-vamp/environment-variables/#example-2">Override the JVM_HEAP_SIZE in production</a></li>
<li><a href="./documentation/using-vamp/environment-variables/#example-3">Use a place holder</a></li>
<li>Just for fun - <a href="./documentation/using-vamp/environment-variables/#example-4">combine all scopes and references</a></li>
</ul>

<h4 id="example-1">Example 1</h4>

<p><strong>Run two of the same services with different configurations</strong></p>

<p><strong>Use case:</strong> As a devOps-er you want to test one service configured in two different ways at the same time. Your service is configurable using environment variables. In this case we are testing a connection pool setting.</p>

<p><strong>Implementation:</strong> In the below blueprint we just use the breed level environment variables. The traffic is split into a <sup>50</sup>&frasl;<sub>50</sub> divide between both services.</p>

<pre><code class="language-yaml">---
name: production_deployment:1.0
gateways:
  9050: frontend/port
clusters:
  frontend:
    services:
      -
        breed:
          name: frontend_app:1.0-a
          deployable: acmecorp/tomcat:1.2.1
          ports:
            port: 8080/http
          environment_variables:           
            CONNECTION_POOL: 30                
      -
        breed:
          name: frontend_app:1.0-b              # different breed name, same deployable
          deployable: acmecorp/tomcat:1.2.1
          ports:
            port: 8080/http
          environment_variables:           
            CONNECTION_POOL: 60                 # different pool size

  gateways:
    frontend_app:1.0-a:
      weight: 50% 
    frontend_app:1.0-b:
      weight: 50% 
</code></pre>

<h4 id="example-2">Example 2</h4>

<p><strong>Override the JVM_HEAP_SIZE in production</strong></p>

<p><strong>Use case:</strong> As a developer, you created your service with a default heap size you use on your development laptop and maybe on a test environment. Once your service goes &ldquo;live&rdquo;, an ops guy/gal should be able to override this setting.</p>

<p><strong>Implementation:</strong> In the below blueprint we override the variable <code>JVM_HEAP_SIZE</code> for the whole <code>frontend</code> cluster by specifically marking it with .dot-notation <code>cluster.variable</code></p>

<pre><code class="language-yaml">---
name: production_deployment:1.0
gateways:
  9050: frontend/port
environment_variables:                  # cluster level variable 
  frontend.JVM_HEAP_SIZE: 2800          # overrides the breed level
clusters:
  frontend:
    services:
      -
        breed:
          name: frontend_app:1.0
          deployable: acmecorp/tomcat:1.2.1
          ports:
            port: 8080/http
          environment_variables:           
            JVM_HEAP_SIZE: 1200         # will be overridden by deployment level: 2800
</code></pre>

<h4 id="example-3">Example 3</h4>

<p><strong>Use a place holder</strong></p>

<p><strong>Use case:</strong> As a developer, you might not know some value your service needs at runtime, say the Google Anaytics ID your company uses. However, your Node.js frontend needs it!</p>

<p><strong>Implementation:</strong> In the below blueprint the <code>~</code> place holder is used to explicitly demand that a variable is set by a higher scope. When this variable is NOT provided, Vamp will report an error at deploy time.</p>

<pre><code class="language-yaml">---
name: production_deployment:1.0
gateways:
  9050: frontend/port
environment_variables:                            # cluster level variable 
  frontend.GOOGLE_ANALYTICS_KEY: 'UA-53758816-1'  # overrides the breed level
clusters:
  frontend:
    services:
      -
        breed:
          name: frontend_app:1.0
          deployable: acmecorp/node_express:1.0
          ports:
            port: 8080/http
          environment_variables:           
            GOOGLE_ANALYTICS_KEY: ~               # If not provided at higher scope, 
                                                  # Vamp reports error.
</code></pre>

<h4 id="example-4">Example 4</h4>

<p><strong>Combine all scopes and references</strong></p>

<p>As a final example, let&rsquo;s combine some of the examples above and include referenced breeds. In this case, we have two breed artifacts already stored in Vamp and include them by using the <code>ref</code> keyword.</p>

<p>In the below blueprint:</p>

<ul>
<li>we override all breed scope <code>JVM_HEAP_SIZE</code> variables with cluster scope <code>environment_variables</code></li>
<li>to further tweak the <code>JVM_HEAP_SIZE</code> for the service <code>frontend_app:1.0-b</code>, we also add service scope <code>environment_variables</code> for that service.</li>
</ul>

<pre><code class="language-yaml">---
name: production_deployment:1.0
gateways:
  9050: frontend/port
environment_variables:                            # cluster level variable 
  frontend.JVM_HEAP_SIZE: 2400                    # overrides the breed level
clusters:
  frontend:
    services:
      - breed:
          ref: frontend_app:1.0-a
      - breed:
          ref: frontend_app:1.0-b        
        environment_variables:           
          JVM_HEAP_SIZE: 1800               # overrides the breed level AND cluster level
          
  gateways:
    frontend_app:1.0-a:
      weight: 50% 
    frontend_app:1.0-b:
      weight: 50% 
</code></pre>

<h2 id="constants">Constants</h2>

<p>Sometimes you just want configuration information to be available in a breed or blueprint. You don&rsquo;t need that information to be directly exposed as an environment variable. As a convenience, Vamp allows you to set <code>constants</code>.
These are values that cannot be changed during deploy time.</p>

<p>You can do everything with <code>environment_variables</code> but <code>constants</code> allow you to just be a little bit cleaner with regard to what you want to expose and what not.</p>

<h4 id="exammple-using-constants">Exammple - using constants</h4>

<pre><code class="language-yaml">---
clusters:
  frontend:
    breed:
      name: frontend_app:1.0
      environment_variables:
        MYSQL_HOST: $backend.host       
        MYSQL_PORT: $backend.ports.port 
        BACKEND_ENCODING: $backend.environment_variables.ENCODING_TYPE
        SCHEMA: $backend.constants.SCHEMA_NAME
      dependencies:
        backend: mysql:1.0
  backend:
    breed:
      name: mysql:1.0
      environment_variables:
        ENCODING_TYPE: 'UTF8'
      constants:
        SCHEMA_NAME: 'customers'    # NOT injected into the backend MySQL container
</code></pre>

<div class="admonition note">
  <p class="admonition-title">What next?</p>
  <p><ul>
<li>Read about <a href="./documentation/using-vamp/gateways/">Vamp gateways</a></li>
<li>Check the <a href="./documentation/api/api-reference">API documentation</a></li>
<li><a href="./documentation/installation/hello-world">Try Vamp</a></li>
</ul>
</p>
</div>

      </div>
    </div>
</div>

<div class="lander-row lander-row--blue footer">
  <div class="container">
    <div class="row">
      <div class="col col-3">
        <h2 class="h2">Learn more</h2>
        <a href="./why-use-vamp/">
          <p class="text">Why use Vamp?</p>
        </a>
        <a href="./documentation/how-vamp-works/architecture-and-components">
          <p class="text">Documentation</p>
        </a>
        <a href="./about/">
          <p class="text">About us</p>
        </a>
        <a href="./resources/news/">
          <p class="text">News</p>
        </a>
        <a href="./contact/">
          <p class="text">Contact</p>
        </a>
      </div>
        <div class="col col-6">
        <h2 class="h2">All things code</h2>
          <a href="./support/">
            <p class="text">Support</p>
          </a>
          <a href="./resources/community/">
            <p class="text">Community</p>
          </a>
          <a href="https://github.com/magneticio/vamp" target="_blank">
            <p class="text">GitHub</p>
          </a>
          <a href="https://gitter.im/magneticio/vamp" target="_blank">
            <p class="text">Gitter</p>
          </a>
      </div>
      <div class="col col-6">
        <h2 class="h2">Stay up to date</h2>
        <p class="text">
          Leave your email for the latest news: We won’t spam you and won’t go off topic.
        </p>

        <form action="//magnetic.us9.list-manage.com/subscribe/post?u=c709b3ab8cce9e00d617e01b6&amp;id=c1465e21d0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate form-inline" style="display: inline" target="_blank" novalidate="">
          <div class="input-group">
            <input type="email" name="EMAIL" id="mce-EMAIL" placeholder="Email">
            <a onclick="$(this).closest('form').submit()" class="button button--red not-active">
              <div class="button__icon button__icon--mail">
              </div>
            </a>
          </div>
        </form>

        
          
        


        <div class="social-buttons">
          <p class="text">Follow us on: </p>
          <a href="https://twitter.com/vamp_io" target="_blank">
            <i class="fa fa-2x fa-twitter"></i>
          </a>

          <a href="https://www.linkedin.com/company/magnetic-io" target="_blank">
            <i class="fa fa-2x fa-linkedin"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="footer-bottom lander-row--blue">
  <div class="container">
    <div class="part">
      <a href="./about/"><img class="magnetic-logo" src="./img/005-vamp/Logo/magnetic-logo-footer.svg" alt=""></a>
    </div>
    <div class="part">
      <img class="vamp-bat" src="./img/003-Small-icons/Medium-blue/VAMP-Medium.svg" alt="">
      <p class="text">Code licensed under <a type="application/rss+xml" href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache 2</a> © 2016 <a href="./about/">Magnetic.io</a></p>
    </div>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59948816-1', 'auto');
  ga('send', 'pageview');

</script>

